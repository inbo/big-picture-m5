---
title: "Data preparation from Survey Monkey"
author: "Lynn Pallemaerts"
date: "2025-01-07"
output:
  html_document: default
---

# Libraries

```{r}
library(devtools)
devtools::install_github("mattroumaya/surveymonkey")
library(tidyverse)
```

# Connect with Survey monkey

```{r}
m5_survey <- surveymonkey::browse_surveys(title = "Indentifying data sharing issues regarding camera trap data in Europe -- dummy version",
                                          oauth_token = sm_oauth_token)
survey_ID <- c(m5_survey$id)

# Get whole survey
survey <- surveymonkey::fetch_survey_obj(survey_ID,
                                         oauth_token = sm_oauth_token)
survey_df <- surveymonkey::parse_survey(survey,
                                        oauth_token = sm_oauth_token) %>%
  surveymonkey::strip_html()
```

# Get question list

```{r}
qs <- read_delim("./Input/question_list_dummy.csv",
                 delim = ";")
```

# Basic data exploration

```{r}
# Get number of total respondents
length(unique(survey_df$respondent_id))

# Get number of complete responses
resp <- survey_df %>%
  select(-survey_id, -collector_id, -date_created, -date_modified) %>%
  filter(response_status == "completed") %>%
  select(-response_status)
length(unique(resp$respondent_id))
```

# Make subset for each question

```{r}
for (i in 1:nrow(qs)) {
  name <- qs$code[i]
  question <- qs$question[i]
  assign(name, 
         survey_df %>%
           dplyr::select(respondent_id, contains(question)))
}
remove(i, name, question)
```

# Clean individual dataframes

## Q1

```{r}
Q1 <- q1 %>%
  pivot_longer(!respondent_id, names_to = "long_answer", values_to = "response") %>%
  filter(!is.na(response)) %>%
  mutate(question = qs$question[qs$code == "q1"]) %>%
  mutate(nchar = nchar(question)) %>%
  mutate(long_answer = substring(long_answer, nchar + 4)) %>%
  select(respondent_id, question, response) %>%
  write_csv2("./Interim/dummy_question1.csv")
remove(q1)
```

## Q2

```{r}
Q2 <- q2 %>%
  mutate(question = qs$question[qs$code == "q2"]) %>%
  rename(response = "What country is your primary affiliation located in?") %>%
  select(respondent_id, question, response) %>%
  write_csv2("./Interim/dummy_question2.csv")
remove(q2)
```

# Get only responses

```{r}
responses <- surveymonkey::parse_survey(fullSurvey,
                                        oauth_token = token)
responses <- responses %>%
  surveymonkey::strip_html()
```
